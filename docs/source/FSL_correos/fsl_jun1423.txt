Hi Matthew,

Thank you for your response. I composed my f-test contrast file in the glm gui as

ev1 ev2 ev3 f
1  0  0  x
0  1  0  x
0  0  1  x

Is this a correct? Or possibly if not, a reason that my t-tests are non-significant?

Kind regards,
Ben

########################################################################

Thank you Saad.

I have now tried to repeat the process with a bigger number of patients and controls. I have re-run eddy_qc and checked all qc.json (they appear normal to me) with the patients and controls groups.

The code looks like this: 

echo "group" > QC_group_PSP.txt

for control in 15581    23085 25896 18066 13756 ; do

echo `ls -d $dir/sub-$control/ses-*/preproc/dwifslpreproc-tmp-*/eddy_qc/qc.json` >> $dir/QC_list_PSP.txt

echo "0" >> $dir/QC_group_PSP.txt

done

echo "done controls"

for PSP in 16257  20400       21490 21153 19471; do

echo `ls -d $dir/sub-$PSP/ses-*/preproc/dwifslpreproc-tmp-*/eddy_qc/qc.json` >> $dir/QC_list_PSP.txt

echo "1" >> $dir/QC_group_PSP.txt

done

echo "done PSP"

eddy_squad $dir/QC_list_PSP.txt \
          -g $dir/QC_group_PSP.txt \
          -o $dir/TEST_M

echo 'done'


However, I am still getting error:

Generating group database...
Traceback (most recent call last):
  File "/usr/local/software/fsl/6.0.4/bin/eddy_squad", line 42, in <module>
    main(args.list, args.grouping, args.group_db, args.update, args.output_dir)
  File "/usr/local/software/fsl/6.0.4/fslpython/envs/fslpython/lib/python3.7/site-packages/eddy_qc/SQUAD/squad.py", line 87, in main
    db = squad_db.main(out_dir + '/group_db.json', 'w', sList)
  File "/usr/local/software/fsl/6.0.4/fslpython/envs/fslpython/lib/python3.7/site-packages/eddy_qc/SQUAD/squad_db.py", line 42, in main
    raise ValueError(qc_json + ' does not appear to be a valid qc.json file')
ValueError: /home/mt892/rds/rds-rowe-k1PgZFWfeZY/group/p00259/DTI_preproc/test1/testing_squad_5x/sub-15581/ses-20081106/preproc/dwifslpreproc-tmp-RKIAAZ/eddy_qc/qc.json/qc.json does not appear to be a valid qc.json file
done


Any suggestions on what may be happening please? 

Mariana


Dear Matthew,

If I add another EV for gender, do I need to add 2 contrasts (as show below) for this covariate? Or 1 contrast is enough?

FSL wiki website says "A contrast that pulls out only the Gender covariate tests whether the male/female difference is significant", but I get two constrasts C5 & 6, how to interpret them?  


Dear Erin,
We generally recommend de-meaning any covariate which doesn’t model ( in part or in full ) the global mean, as a precaution, since for many contrasts it provides a more conventional interpretation of the inference ( being at the mean of the covariate and not zero ). It is also often a useful step before “splitting" a regressor ( e.g age by group ). For the specific design and contrasts in the example below though, demeaning will make no difference to the inference.

Hope this helps,
Kind Regards
Matthew
--------------------------------
Dr Matthew Webster
FMRIB Centre 
John Radcliffe Hospital
University of Oxford


Dear Matthew,



You said the covariates do not need to be demeaned, which is different from "mean center each covariate" on the website of https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/GLM#Two-Group_Difference_Adjusted_for_Covariate.  Which one should I follow? What is the reason?


Thanks.


Kind regards,
Erin


At 2023-06-12 23:32:10, "Matthew Webster"

Hi Matthew,
Thank you very much for your reply. I do not have the original unbetted images. Is it absolutely necessary to have them in order to run fsl vbm?
Best
Shuo

########################################################################

Dear FSL experts,

I have I have used drifit with a single patient after manually (and successfully) doing it on fsl interface - I need to escalate this later to a much larger number. The input in the command line is as follows:

dtifit --data=dwi_biascorr_epi.nii \
              --bvals=bvals \
              --bvecs=dwi_post_eddy.eddy_rotated_bvecs \
              --out=dti_fit \
              --mask=nodif_brain_epi_mask.nii.gz \
              --wls

However, I get the following error:

0 96 0 96 0 63
0 slices processed

error: solve(): solution not found

terminate called after throwing an instance of 'std::runtime_error'
  what():  solve(): solution not found
Aborted

Is it possible to know what I am doing incorrectly?

Regards,
Mariana

########################################################################

Hi Emma,

I faced the same problem with yours, have you ever figure it out yet?

BW,
Yuting

########################################################################

Dear FSL experts,

I want to run correlations between cognitive domains and the template generated by VBM.

I wonder if I have to demean the scores of the different cognitive domains.

I wonder if I should covariate for age, gender or years of education.

Kind regards,

Rosalia




Hi Michael,

Yes, the distortion is clearly visible in AP / PA direction, hence that is the reason why I set pedir to y and -y. Just to be sure, I also tried pedir set to x, -x, z and -z, but along each axis (x,y or z) te output is exactly the same.

When I perform topup myself, the distortion corrected asl_m0_topup.nii is indeed corrected:
echo -e "0 -1 0 $TotalReadoutTime\n0 1 0 $TotalReadoutTime_reversed" > "$workingDir"/acquisitionsParamaters.txt
fslmerge -t "$workingDir"/asl_PA_AP.nii "$workingDir"/asl_m0.nii "$workingDir"/asl_m0_reversed.nii

topup \
--imain="$workingDir"/asl_PA_AP.nii \
--datain="$workingDir"/acquisitionsParamaters.txt \
--config=b02b0.cnf \
--fout="$workingDir"/fmap.nii \
--out="$workingDir"/topup_PA_AP

# Apply topup file
sed -i '$ d' "$workingDir"/acquisitionsParamaters.txt
applytopup \
--imain="$workingDir"/asl_m0.nii \
--datain="$workingDir"/acquisitionsParamaters.txt \
--inindex=1 \
--topup="$workingDir"/topup_PA_AP \
--method=jac \
--out="$workingDir"/asl_m0_topup.nii

And as far as I can tell, tthe oxford_asl command does the same:
fslmerge -t $tempdir/calib_blipped $tempdir/calib $tempdir/cblip
topup --imain=$tempdir/calib_blipped --datain=$tempdir/topup_params.txt --config=b02b0.cnf --out=$tempdir/topupresult --fout=$tempdir/topupresult_fmap
applytopup --imain=$tempdir/asldata --datain=$tempdir/topup_params.txt --inindex=1 --topup=${topupresult} --out=$tempdir/asldata --method=jac

########################################################################


Hello,
I’ve answered this in the other thread.

Kind Regards
Matthew
--------------------------------
Dr Matthew Webster
FMRIB Centre 
John Radcliffe Hospital
University of Oxford

On 13 Jun 2023, at 17:59, <Nonameavailable> <jkblujus@UWM.EDU> wrote:

Hello,

I have a question regarding the interpretation of contrasts 3 and 4 from the Two-Group Difference Adjusted for Covariate on the GLM wiki page. The webpage states that "The interpretation of C1 is Group1>Group2, adjusted for age. Likewise C2 is Group2>Group1, adjusted for age. C3 is the positive age effect and C4 is the negative age effect.". Is contrast 3 interpreted as the positive age effect, adjusted for group?

Best,
Jenna Blujus

########################################################################

To unsubscribe from the FSL list, click the following link:
https://www.jiscmail.ac.uk/cgi-bin/WA-JISC.exe?SUBED1=FSL&A=1

This message was issued to members of www.jiscmail.ac.uk/FSL, a mailing list hosted by www.jiscmail.ac.uk, terms & conditions are available at https://www.jiscmail.ac.uk/policyandsecurity/


Hello Jenna,
   That’s correct, you could also consider the GLM estimates as being driven by unique variance, a regressor’s variance taking into account all other regressors, and so any linear combination of those estimates will necessarily be doing the same.

Kind Regards
Matthew
--------------------------------
Dr Matthew Webster
FMRIB Centre 
John Radcliffe Hospital
University of Oxford

Hello,

I have a question regarding the interpretation of contrast 3/4 from the Two-Group Difference Adjusted for Covariate model on the GLM wiki page. The contrasts are described on the wiki page as "The interpretation of C1 is Group1>Group2, adjusted for age. Likewise C2 is Group2>Group1, adjusted for age. C3 is the positive age effect and C4 is the negative age effect."

Is contrast 3 interpreted as the positive age effect, adjusted for group?

Thanks,
Jenna

########################################################################

Hi Rona,

Your command looks ok. This kind of issue can, however, occur, when commands are copy+pasted from e.g. a web browser or MS Word document, where hyphen and quote characters may be converted into Unicode characters which look similar, but are not identical, to their ASCII counterparts.

Is there a chance that this is happening here? What happens if you type out the full command by hand?

Paul

Yes, here is the command I tried to run with the "--ref" argument:

fnirt --ref=$FSLDIR/data/standard/MNI152_T1_2mm.nii.gz --in=T1w_brain.nii.gz --aff=T1toMNIlin.mat --config=T1_2_MNI152_2mm.cnf --iout=T1toMNInonlin.nii.gz --cout=T1toMNI_coef.nii.gz --fout=T1toMNI_warp.nii.gz

of course all the files were defined with their full paths (which I didn't want to share publicly).

I couldn't replicate the error now, although it happened in all my last attempts. Again I just get the output of the help menu for fnirt.


Part of FSL (ID: "")
fnirt

Usage:
fnirt --ref=<some template> --in=<some image>
fnirt --ref=<some template> --in=<some image> --infwhm=8,4,2 --subsamp=4,2,1 --warpres=8,8,8

Compulsory arguments (You MUST set one or more of):
        --ref           name of reference image
        --in            name of input image

Optional arguments (You may optionally specify one or more of):
        --aff           name of file containing affine transform
        --inwarp        name of file containing initial non-linear warps
        --intin         name of file/files containing initial intensity mapping
        --cout          name of output file with field coefficients
        --iout          name of output image
        --fout          name of output file with field
        --jout          name of file for writing out the Jacobian of the field (for diagnostic or VBM purposes)
        --refout        name of file for writing out intensity modulated --ref (for diagnostic purposes)
        --intout        name of files for writing information pertaining to intensity mapping
        --logout        Name of log-file
        --config        Name of config file specifying command line arguments
        --refmask       name of file with mask in reference space
        --inmask        name of file with mask in input image space
        --applyrefmask  Use specified refmask if set, default 1 (true)
        --applyinmask   Use specified inmask if set, default 1 (true)
        --imprefm       If =1, use implicit masking based on value in --ref image. Default =1
        --impinm        If =1, use implicit masking based on value in --in image, Default =1
        --imprefval     Value to mask out in --ref image. Default =0.0
        --impinval      Value to mask out in --in image. Default =0.0
        --minmet        non-linear minimisation method [lm | scg] (Levenberg-Marquardt or Scaled Conjugate Gradient)
        --miter         Max # of non-linear iterations, default 5,5,5,5
        --subsamp       sub-sampling scheme, default 4,2,1,1
        --warpres       (approximate) resolution (in mm) of warp basis in x-, y- and z-direction, default 10,10,10
        --splineorder   Order of spline, 2->Quadratic spline, 3->Cubic spline. Default=3
        --infwhm        FWHM (in mm) of gaussian smoothing kernel for input volume, default 6,4,2,2
        --reffwhm       FWHM (in mm) of gaussian smoothing kernel for ref volume, default 4,2,0,0
        --regmod        Model for regularisation of warp-field [membrane_energy bending_energy], default bending_energy
        --lambda        Weight of regularisation, default depending on --ssqlambda and --regmod switches. See user documentation.
        --ssqlambda     If set (=1), lambda is weighted by current ssq, default 1
        --jacrange      Allowed range of Jacobian determinants, default 0.01,100.0
        --refderiv      If =1, ref image is used to calculate derivatives. Default =0
        --intmod        Model for intensity-mapping [none global_linear global_non_linear local_linear global_non_linear_with_bias local_non_linear]
        --intorder      Order of polynomial for mapping intensities, default 5
        --biasres       Resolution (in mm) of bias-field modelling local intensities, default 50,50,50
        --biaslambda    Weight of regularisation for bias-field, default 10000
        --estint        Estimate intensity-mapping if set, default 1 (true)
        --numprec       Precision for representing Hessian, double or float. Default double
        --interp        Image interpolation model, linear or spline. Default linear
        -v,--verbose    Print diagnostic information while running
        -h,--help       display help info

########################################################################

